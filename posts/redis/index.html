<!DOCTYPE html>
<html lang="zh-CN">
    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>redis安装 - yx&#39;s blog</title><meta name="Description" content="关于redis各平台的安装"><meta property="og:title" content="redis安装" />
<meta property="og:description" content="关于redis各平台的安装" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/posts/redis/" /><meta property="og:image" content="http://localhost:1313/images/yyttww.png" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-04-14T22:07:16+08:00" />
<meta property="article:modified_time" content="2024-04-14T22:07:16+08:00" /><meta property="og:site_name" content="我的网站" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="http://localhost:1313/images/yyttww.png" /><meta name="twitter:title" content="redis安装"/>
<meta name="twitter:description" content="关于redis各平台的安装"/>
<meta name="application-name" content="我的网站">
<meta name="apple-mobile-web-app-title" content="我的网站"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="/images/yyttww.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="http://localhost:1313/posts/redis/" /><link rel="prev" href="http://localhost:1313/posts/demo02/" /><link rel="next" href="http://localhost:1313/posts/jwt/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "redis安装",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/localhost:1313\/posts\/redis\/"
        },"genre": "posts","wordcount":  8688 ,
        "url": "http:\/\/localhost:1313\/posts\/redis\/","datePublished": "2024-04-14T22:07:16+08:00","dateModified": "2024-04-14T22:07:16+08:00","license": "write By yuxin","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "ytw"
            },"description": "关于redis各平台的安装"
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="fixed"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('dark' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'dark' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="yx&#39;s blog"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/images/tttt.jpg"
        data-srcset="/images/tttt.jpg, /images/tttt.jpg 1.5x, /images/tttt.jpg 2x"
        data-sizes="auto"
        alt="/images/tttt.jpg"
        title="/images/tttt.jpg" />ytw</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/" title="文章"> 文章 </a><a class="menu-item" href="/categories/" title="分类"> 分类 </a><a class="menu-item" href="/about/"> 关于ytw </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="请输入关键字" id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="yx&#39;s blog"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/images/tttt.jpg"
        data-srcset="/images/tttt.jpg, /images/tttt.jpg 1.5x, /images/tttt.jpg 2x"
        data-sizes="auto"
        alt="/images/tttt.jpg"
        title="/images/tttt.jpg" />ytw</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="请输入关键字" id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title="文章">文章</a><a class="menu-item" href="/categories/" title="分类">分类</a><a class="menu-item" href="/about/" title="">关于ytw</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">redis安装</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/about/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>ytw</a></span>&nbsp;<span class="post-category">included in <a href="/categories/deploy/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>deploy</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2024-04-14">2024-04-14</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;8688 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;18 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="true">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#优化警告httpswwwcnblogscomneeoarticles17609004html优化警告">优化警告<a href="https://www.cnblogs.com/Neeo/articles/17609004.html#%E4%BC%98%E5%8C%96%E8%AD%A6%E5%91%8A">#</a></a>
      <ul>
        <li><a href="#警告1maximum-open-files过低httpswwwcnblogscomneeoarticles17609004html警告1maximum-open-files过低">警告1：maximum open files过低<a href="https://www.cnblogs.com/Neeo/articles/17609004.html#%E8%AD%A6%E5%91%8A1maximum-open-files%E8%BF%87%E4%BD%8E">#</a></a></li>
        <li><a href="#警告2overcommit_memory设置httpswwwcnblogscomneeoarticles17609004html警告2overcommit_memory设置">警告2：overcommit_memory设置<a href="https://www.cnblogs.com/Neeo/articles/17609004.html#%E8%AD%A6%E5%91%8A2overcommit_memory%E8%AE%BE%E7%BD%AE">#</a></a></li>
        <li><a href="#警告3关闭thp内存httpswwwcnblogscomneeoarticles17609004html警告3关闭thp内存">警告3：关闭THP⼤内存⻚<a href="https://www.cnblogs.com/Neeo/articles/17609004.html#%E8%AD%A6%E5%91%8A3%E5%85%B3%E9%97%ADthp%E5%86%85%E5%AD%98">#</a></a></li>
        <li><a href="#警告4tcp连接数调整httpswwwcnblogscomneeoarticles17609004html警告4tcp连接数调整">警告4：TCP连接数调整<a href="https://www.cnblogs.com/Neeo/articles/17609004.html#%E8%AD%A6%E5%91%8A4tcp%E8%BF%9E%E6%8E%A5%E6%95%B0%E8%B0%83%E6%95%B4">#</a></a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#禁用高危命令httpswwwcnblogscomneeoarticles17609005html禁用高危命令">禁用高危命令<a href="https://www.cnblogs.com/Neeo/articles/17609005.html#%E7%A6%81%E7%94%A8%E9%AB%98%E5%8D%B1%E5%91%BD%E4%BB%A4">#</a></a></li>
  </ul>

  <ul>
    <li><a href="#1字符串">1：字符串：</a></li>
    <li><a href="#2列表">2:列表#</a></li>
    <li><a href="#3redis-hashhttpswwwcnblogscomneeoarticles17609005htmlhash">3:Redis-hash<a href="https://www.cnblogs.com/Neeo/articles/17609005.html#hash">#</a></a></li>
    <li><a href="#4集合httpswwwcnblogscomneeoarticles17609005html集合">4集合<a href="https://www.cnblogs.com/Neeo/articles/17609005.html#%E9%9B%86%E5%90%88">#</a></a></li>
    <li><a href="#5-有序集合zsethttpswwwcnblogscomneeoarticles17609005html有序集合zset">5 有序集合zset<a href="https://www.cnblogs.com/Neeo/articles/17609005.html#%E6%9C%89%E5%BA%8F%E9%9B%86%E5%90%88zset">#</a></a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h1 id="1-学习环境介绍">1： 学习环境介绍：</h1>
<pre tabindex="0"><code>windows + vmware:centos 7 
redis3.0.7
</code></pre><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/posts/redis/image-20231021074906577.png"
        data-srcset="/images/posts/redis/image-20231021074906577.png, /images/posts/redis/image-20231021074906577.png 1.5x, /images/posts/redis/image-20231021074906577.png 2x"
        data-sizes="auto"
        alt="/images/posts/redis/image-20231021074906577.png"
        title="image-20231021074906577" /></p>
<h1 id="2--redis-50-版本安装以及配置">2:  redis 5.0 版本安装,以及配置</h1>
<p><strong>下载安装</strong></p>
<p>所有版本下载链接：<a href="https://download.redis.io/releases/" target="_blank" rel="noopener noreffer ">链接1</a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mkdir -p /data/redis6379 
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> /opt
</span></span><span class="line"><span class="cl"><span class="c1"># yum -y install wget</span>
</span></span><span class="line"><span class="cl">wget https://download.redis.io/releases/redis-5.0.7.tar.gz
</span></span><span class="line"><span class="cl">tar -zxf redis-5.0.7.tar.gz
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> /opt/redis-5.0.7
</span></span><span class="line"><span class="cl">make <span class="o">&amp;&amp;</span> make install
</span></span></code></pre></div><p>关于编译安装的命令：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 有一份二进制的软件包，想要安装，一般有以下几个步骤</span>
</span></span><span class="line"><span class="cl">./configure ....	<span class="c1"># 洗菜和切菜，指定安装目录和配置等</span>
</span></span><span class="line"><span class="cl">make			    <span class="c1"># 炒菜，编译安装软件</span>
</span></span><span class="line"><span class="cl">make install		<span class="c1"># 装盘，根据./configure的配置进行实际安装到指定位置</span>
</span></span></code></pre></div><p>安装完成后，Redis可执行程序会自动添加到<code>/usr/local/bin</code>路径，我们就可以在任何地方的terminal中使用Redis相关命令了。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>root@cs opt<span class="o">]</span><span class="c1"># ll /usr/local/bin/redis*</span>
</span></span><span class="line"><span class="cl">-rwxr-xr-x. <span class="m">1</span> root root <span class="m">4365728</span> Aug  <span class="m">1</span> 10:58 /usr/local/bin/redis-benchmark
</span></span><span class="line"><span class="cl">-rwxr-xr-x. <span class="m">1</span> root root <span class="m">8124120</span> Aug  <span class="m">1</span> 10:58 /usr/local/bin/redis-check-aof
</span></span><span class="line"><span class="cl">-rwxr-xr-x. <span class="m">1</span> root root <span class="m">8124120</span> Aug  <span class="m">1</span> 10:58 /usr/local/bin/redis-check-rdb
</span></span><span class="line"><span class="cl">-rwxr-xr-x. <span class="m">1</span> root root <span class="m">4806800</span> Aug  <span class="m">1</span> 10:58 /usr/local/bin/redis-cli
</span></span><span class="line"><span class="cl">lrwxrwxrwx. <span class="m">1</span> root root      <span class="m">12</span> Aug  <span class="m">1</span> 10:58 /usr/local/bin/redis-sentinel -&gt; redis-server
</span></span><span class="line"><span class="cl">-rwxr-xr-x. <span class="m">1</span> root root <span class="m">8124120</span> Aug  <span class="m">1</span> 10:58 /usr/local/bin/redis-server
</span></span></code></pre></div><p>到这一步，我们就可以在任意路径下，调用redis的相关命令了，如：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>root@cs opt<span class="o">]</span><span class="c1"># redis-server -v</span>
</span></span><span class="line"><span class="cl">Redis server <span class="nv">v</span><span class="o">=</span>5.0.7 <span class="nv">sha</span><span class="o">=</span>00000000:0 <span class="nv">malloc</span><span class="o">=</span>jemalloc-5.1.0 <span class="nv">bits</span><span class="o">=</span><span class="m">64</span> <span class="nv">build</span><span class="o">=</span>a67ef2d8861912e7
</span></span></code></pre></div><p><strong>4. 编写配置文件</strong></p>
<p>无密码配置：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mkdir -p /opt/redis6379/<span class="o">{</span>conf,logs,pid<span class="o">}</span>
</span></span><span class="line"><span class="cl">cat &gt;/opt/redis6379/conf/redis6379.conf<span class="s">&lt;&lt;EOF
</span></span></span><span class="line"><span class="cl"><span class="s">daemonize yes
</span></span></span><span class="line"><span class="cl"><span class="s"># 注意，生产中， 千万不要bind 0.0.0.0，不要将Redis暴露到外网环境，防止被人攻击
</span></span></span><span class="line"><span class="cl"><span class="s">bind 127.0.0.1 $(ifconfig ens33|awk &#39;NR==2{print $2}&#39;)
</span></span></span><span class="line"><span class="cl"><span class="s">port 6379
</span></span></span><span class="line"><span class="cl"><span class="s">pidfile /opt/redis6379/pid/redis6379.pid
</span></span></span><span class="line"><span class="cl"><span class="s">logfile /opt/redis6379/logs/redis6379.log
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span></code></pre></div><p><strong>5. 启动命令</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">redis-server /opt/redis6379/conf/redis6379.conf
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ps -ef<span class="p">|</span>grep redis
</span></span></code></pre></div><p><strong>6. 客户端连接</strong></p>
<p>无密码的，客户端直接连接就可以操作，并且支持远程连接：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>root@cs opt<span class="o">]</span><span class="c1"># redis-cli</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ping
</span></span><span class="line"><span class="cl">PONG
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; quit
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@cs opt<span class="o">]</span><span class="c1"># </span>
</span></span></code></pre></div><p><strong>7. 关闭命令</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 结合启动命令测试关闭命令</span>
</span></span><span class="line"><span class="cl">redis-server /opt/redis6379/conf/redis6379.conf
</span></span><span class="line"><span class="cl">ps -ef<span class="p">|</span>grep redis
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 方式1</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@cs opt<span class="o">]</span><span class="c1"># redis-cli</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; SHUTDOWN
</span></span><span class="line"><span class="cl">not connected&gt; quit
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@cs opt<span class="o">]</span><span class="c1"># </span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 方式2</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@cs opt<span class="o">]</span><span class="c1"># redis-cli shutdown</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@cs opt<span class="o">]</span><span class="c1"># </span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 方式3</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@cs opt<span class="o">]</span><span class="c1"># pkill -9 redis</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@cs opt<span class="o">]</span><span class="c1"># </span>
</span></span></code></pre></div><p><strong>8. 可选的配置，配置systemd管理Redis</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 先把之前可能运行的Redis停止</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 创建redis用户和组，以及给相关目录权限</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 创建systemctl管理redis的文件</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 就可以通过systemctl管理redis了</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">redis-cli shutdown
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># -u和-g选项表示同时添加具有特定UID和GID的用户</span>
</span></span><span class="line"><span class="cl"><span class="c1"># -M创建一个没有主目录的用户</span>
</span></span><span class="line"><span class="cl"><span class="c1"># -s表示当前创建的当前用户无法用来登录系统</span>
</span></span><span class="line"><span class="cl"><span class="c1"># chown -R redis:redis表示指定目录以及内部的文件所有用户属组归于redis:redis</span>
</span></span><span class="line"><span class="cl"><span class="c1"># groupdel redis</span>
</span></span><span class="line"><span class="cl"><span class="c1"># cat /etc/group |grep redis</span>
</span></span><span class="line"><span class="cl">groupadd redis -g <span class="m">1000</span>
</span></span><span class="line"><span class="cl"><span class="c1"># userdel redis</span>
</span></span><span class="line"><span class="cl"><span class="c1"># cat /etc/passwd |grep redis</span>
</span></span><span class="line"><span class="cl">useradd redis -u <span class="m">1000</span> -g <span class="m">1000</span> -M -s /sbin/nologin
</span></span><span class="line"><span class="cl">chown -R redis:redis /opt/redis*
</span></span><span class="line"><span class="cl">chown -R redis:redis /data/redis*
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">cat &gt;/usr/lib/systemd/system/redis.service<span class="s">&lt;&lt;EOF
</span></span></span><span class="line"><span class="cl"><span class="s">[Unit]
</span></span></span><span class="line"><span class="cl"><span class="s">Description=Redis persistent key-value database
</span></span></span><span class="line"><span class="cl"><span class="s">After=network.target
</span></span></span><span class="line"><span class="cl"><span class="s">After=network-online.target
</span></span></span><span class="line"><span class="cl"><span class="s">Wants=network-online.target
</span></span></span><span class="line"><span class="cl"><span class="s">[Service]
</span></span></span><span class="line"><span class="cl"><span class="s">ExecStart=/usr/local/bin/redis-server /opt/redis6379/conf/redis6379.conf --supervised systemd
</span></span></span><span class="line"><span class="cl"><span class="s">ExecStop=/usr/local/bin/redis-cli shutdown
</span></span></span><span class="line"><span class="cl"><span class="s">Type=notify
</span></span></span><span class="line"><span class="cl"><span class="s">User=redis
</span></span></span><span class="line"><span class="cl"><span class="s">Group=redis
</span></span></span><span class="line"><span class="cl"><span class="s">RuntimeDirectory=redis
</span></span></span><span class="line"><span class="cl"><span class="s">RuntimeDirectoryMode=0755
</span></span></span><span class="line"><span class="cl"><span class="s">[Install]
</span></span></span><span class="line"><span class="cl"><span class="s">WantedBy=multi-user.target
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">systemctl daemon-reload   <span class="c1"># 当添加或者修改了某个服务的配置文件，就要执行daemon-reload命令重新加载下</span>
</span></span><span class="line"><span class="cl">systemctl start redis
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 启动/停止/重启/查看状态/设置redis开机自启</span>
</span></span><span class="line"><span class="cl">systemctl start/stop/restart/status/enable redis
</span></span></code></pre></div><p>到此，安装成功了。</p>
<h2 id="优化警告httpswwwcnblogscomneeoarticles17609004html优化警告">优化警告<a href="https://www.cnblogs.com/Neeo/articles/17609004.html#%e4%bc%98%e5%8c%96%e8%ad%a6%e5%91%8a" target="_blank" rel="noopener noreffer ">#</a></h2>
<p>如果你查看redis的日志，你会发现启动，日志中会出现一些警告，我们可以针对性的优化这些警告。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">cat /opt/redis6379/logs/redis6379.log
</span></span></code></pre></div><h3 id="警告1maximum-open-files过低httpswwwcnblogscomneeoarticles17609004html警告1maximum-open-files过低">警告1：maximum open files过低<a href="https://www.cnblogs.com/Neeo/articles/17609004.html#%e8%ad%a6%e5%91%8a1maximum-open-files%e8%bf%87%e4%bd%8e" target="_blank" rel="noopener noreffer ">#</a></h3>
<p>就是客户端连接数有点小了，改大点就行了</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">63918:M <span class="m">01</span> Aug <span class="m">2023</span> 11:28:59.700 <span class="c1"># You requested maxclients of 10000 requiring at least 10032 max file descriptors.</span>
</span></span><span class="line"><span class="cl">63918:M <span class="m">01</span> Aug <span class="m">2023</span> 11:28:59.700 <span class="c1"># Server can&#39;t set maximum open files to 10032 because of OS error: Operation not permitted.</span>
</span></span><span class="line"><span class="cl">63918:M <span class="m">01</span> Aug <span class="m">2023</span> 11:28:59.700 <span class="c1"># Current maximum open files is 4096. maxclients has been reduced to 4064 to compensate for low ulimit. If you need higher maxclients increase &#39;ulimit -n&#39;.</span>
</span></span></code></pre></div><p>解决，systemd启动文件添加参数<code>LimitNOFILE</code>：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">cat &gt;/usr/lib/systemd/system/redis.service<span class="s">&lt;&lt;EOF
</span></span></span><span class="line"><span class="cl"><span class="s">[Unit]
</span></span></span><span class="line"><span class="cl"><span class="s">Description=Redis persistent key-value database
</span></span></span><span class="line"><span class="cl"><span class="s">After=network.target
</span></span></span><span class="line"><span class="cl"><span class="s">After=network-online.target
</span></span></span><span class="line"><span class="cl"><span class="s">Wants=network-online.target
</span></span></span><span class="line"><span class="cl"><span class="s">[Service]
</span></span></span><span class="line"><span class="cl"><span class="s">ExecStart=/usr/local/bin/redis-server /opt/redis6379/conf/redis6379.conf --supervised systemd
</span></span></span><span class="line"><span class="cl"><span class="s">ExecStop=/usr/local/bin/redis-cli shutdown
</span></span></span><span class="line"><span class="cl"><span class="s">Type=notify
</span></span></span><span class="line"><span class="cl"><span class="s">User=redis
</span></span></span><span class="line"><span class="cl"><span class="s">Group=redis
</span></span></span><span class="line"><span class="cl"><span class="s">RuntimeDirectory=redis
</span></span></span><span class="line"><span class="cl"><span class="s">RuntimeDirectoryMode=0755
</span></span></span><span class="line"><span class="cl"><span class="s">LimitNOFILE=65536
</span></span></span><span class="line"><span class="cl"><span class="s">[Install]
</span></span></span><span class="line"><span class="cl"><span class="s">WantedBy=multi-user.target
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span></code></pre></div><h3 id="警告2overcommit_memory设置httpswwwcnblogscomneeoarticles17609004html警告2overcommit_memory设置">警告2：overcommit_memory设置<a href="https://www.cnblogs.com/Neeo/articles/17609004.html#%e8%ad%a6%e5%91%8a2overcommit_memory%e8%ae%be%e7%bd%ae" target="_blank" rel="noopener noreffer ">#</a></h3>
<p>虚拟内存相关，overcommit_memory 表内存分配策略，可选值：0、1、2</p>
<p>0，表示内核将检查是否有足够的可用内存供应用进程使用；如果有足够的可用内存，内存申请允许；否则，内存申请失败，并把错误返回给应用进程。
1， 表示内核允许分配所有的物理内存，而不管当前的内存状态如何。
2， 表示内核允许分配超过所有物理内存和交换空间总和的内存</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">63918:M <span class="m">01</span> Aug <span class="m">2023</span> 11:28:59.701 <span class="c1"># WARNING overcommit_memory is set to 0! Background save may fail under low memory condition. To fix this issue add &#39;vm.overcommit_memory = 1&#39; to /etc/sysctl.conf and then reboot or run the command &#39;sysctl vm.overcommit_memory=1&#39; for this to take effect.,</span>
</span></span></code></pre></div><p>解决：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 临时解决</span>
</span></span><span class="line"><span class="cl">sysctl vm.overcommit_memory<span class="o">=</span><span class="m">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 永久解决 vim /etc/sysctl.conf  追加：</span>
</span></span><span class="line"><span class="cl">vm.overcommit_memory<span class="o">=</span><span class="m">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 生效配置</span>
</span></span><span class="line"><span class="cl">sysctl -p
</span></span></code></pre></div><h3 id="警告3关闭thp内存httpswwwcnblogscomneeoarticles17609004html警告3关闭thp内存">警告3：关闭THP⼤内存⻚<a href="https://www.cnblogs.com/Neeo/articles/17609004.html#%e8%ad%a6%e5%91%8a3%e5%85%b3%e9%97%adthp%e5%86%85%e5%ad%98" target="_blank" rel="noopener noreffer ">#</a></h3>
<p>redis建议我们关掉THP，还给出的具体的操作办法，注意必须使用root来操作，否则会失败。</p>
<ul>
<li><code>Linux kernel</code> 在 2.6.38 的版本中新增了 <code>THP</code> 的特性，支持大内存页（2MB）分配，默认开启。</li>
<li>当开启 <code>THP</code> 时会降低 <code>fork</code> 子进程的速度，但是 <code>fork</code> 操作之后，每个内存页从原来 4KB 变为 2MB，会大幅增加重写期间父进程内存消耗。</li>
<li>同时每次写命令引起的复制内存也单位放大了 512 倍，会拖慢写操作的时间，导致大量写操作慢查询，例如：简单的 incr、set 命令也会出现在慢查询中。</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">63918:M <span class="m">01</span> Aug <span class="m">2023</span> 11:28:59.701 <span class="c1"># WARNING you have Transparent Huge Pages (THP) support enabled in your kernel. This will create latency and memory usage issues with Redis. To fix this issue run the command &#39;echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled&#39; as root, and add it to your /etc/rc.local in order to retain the setting after a reboot. Redis must be restarted after THP is disabled.</span>
</span></span></code></pre></div><p>解决，必须以root用户执行下面的命令：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 临时解决</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> never &gt; /sys/kernel/mm/transparent_hugepage/enabled
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 永久解决 vim /etc/rc.local  追加：</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> never &gt; /sys/kernel/mm/transparent_hugepage/enabled
</span></span></code></pre></div><h3 id="警告4tcp连接数调整httpswwwcnblogscomneeoarticles17609004html警告4tcp连接数调整">警告4：TCP连接数调整<a href="https://www.cnblogs.com/Neeo/articles/17609004.html#%e8%ad%a6%e5%91%8a4tcp%e8%bf%9e%e6%8e%a5%e6%95%b0%e8%b0%83%e6%95%b4" target="_blank" rel="noopener noreffer ">#</a></h3>
<p>意思是配置 /proc/sys/net/core/somaxconn的值是128，但redis.conf中配置的是511，但是<a href="https://so.csdn.net/so/search?q=linux&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreffer ">linux</a>内核会以无提示的方式将其截断为128。在一个高并发的环境下，128是远远不够的，所以我们要改大一些。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">63918:M <span class="m">01</span> Aug <span class="m">2023</span> 11:28:59.701 <span class="c1"># WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.</span>
</span></span></code></pre></div><p>解决：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 永久解决 vim /etc/sysctl.conf  追加：</span>
</span></span><span class="line"><span class="cl">net.core.somaxconn<span class="o">=</span> <span class="m">4096</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 生效配置</span>
</span></span><span class="line"><span class="cl">sysctl -p
</span></span></code></pre></div><p>然后在重启下redis，并观察日志：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 先清空原有的日志内容</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 然后重启redis</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 观察日志输出</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;&#34;</span>&gt;/opt/redis6379/logs/redis6379.log
</span></span><span class="line"><span class="cl">cat /opt/redis6379/logs/redis6379.log
</span></span><span class="line"><span class="cl">systemctl daemon-reload
</span></span><span class="line"><span class="cl">systemctl stop redis
</span></span><span class="line"><span class="cl">systemctl status redis
</span></span><span class="line"><span class="cl">systemctl start redis
</span></span><span class="line"><span class="cl">systemctl status redis
</span></span><span class="line"><span class="cl">cat /opt/redis6379/logs/redis6379.log
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 这输出就很干净了啊</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@cs opt<span class="o">]</span><span class="c1"># cat /opt/redis6379/logs/redis6379.log</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">79069:C <span class="m">01</span> Aug <span class="m">2023</span> 12:05:05.217 <span class="c1"># oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span>
</span></span><span class="line"><span class="cl">79069:C <span class="m">01</span> Aug <span class="m">2023</span> 12:05:05.217 <span class="c1"># Redis version=5.0.7, bits=64, commit=00000000, modified=0, pid=79069, just started</span>
</span></span><span class="line"><span class="cl">79069:C <span class="m">01</span> Aug <span class="m">2023</span> 12:05:05.217 <span class="c1"># Configuration loaded</span>
</span></span><span class="line"><span class="cl">79069:C <span class="m">01</span> Aug <span class="m">2023</span> 12:05:05.217 * supervised by systemd, will signal readiness
</span></span><span class="line"><span class="cl">79069:M <span class="m">01</span> Aug <span class="m">2023</span> 12:05:05.218 * Running <span class="nv">mode</span><span class="o">=</span>standalone, <span class="nv">port</span><span class="o">=</span>6379.
</span></span><span class="line"><span class="cl">79069:M <span class="m">01</span> Aug <span class="m">2023</span> 12:05:05.218 <span class="c1"># Server initialized</span>
</span></span><span class="line"><span class="cl">79069:M <span class="m">01</span> Aug <span class="m">2023</span> 12:05:05.219 * Ready to accept connections
</span></span></code></pre></div><p>最终这些调整完，最好重启下服务器。然后再启动下redis就好了。</p>
<h1 id="3关于密码httpswwwcnblogscomneeoarticles17609004html关于密码">3:关于密码<a href="https://www.cnblogs.com/Neeo/articles/17609004.html#%e5%85%b3%e4%ba%8e%e5%af%86%e7%a0%81" target="_blank" rel="noopener noreffer ">#</a></h1>
<p>如果需要密码，用下面的配置：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mkdir -p /opt/redis6379/<span class="o">{</span>conf,logs,pid<span class="o">}</span>
</span></span><span class="line"><span class="cl">cat &gt;/opt/redis6379/conf/redis6379.conf<span class="s">&lt;&lt;EOF
</span></span></span><span class="line"><span class="cl"><span class="s">daemonize yes
</span></span></span><span class="line"><span class="cl"><span class="s"># 注意，生产中， 千万不要bind 0.0.0.0，不要将Redis暴露到外网环境，防止被人攻击，这里为了演示方便才这么做的
</span></span></span><span class="line"><span class="cl"><span class="s">bind 0.0.0.0
</span></span></span><span class="line"><span class="cl"><span class="s"># requirepass 后面跟空格，空格后面是你要设置的密码
</span></span></span><span class="line"><span class="cl"><span class="s">requirepass 1234
</span></span></span><span class="line"><span class="cl"><span class="s">port 6379
</span></span></span><span class="line"><span class="cl"><span class="s">pidfile /opt/redis6379/pid/redis6379.pid
</span></span></span><span class="line"><span class="cl"><span class="s">logfile /opt/redis6379/logs/redis6379.log
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span><span class="line"><span class="cl">systemctl restart redis
</span></span></code></pre></div><p>更改了配置文件，别忘了重启Redis。</p>
<p>有密码的，这么连接：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>root@cs opt<span class="o">]</span><span class="c1"># redis-cli    				# 这里默认连接的是6379端口的Redis服务</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ping
</span></span><span class="line"><span class="cl"><span class="o">(</span>error<span class="o">)</span> NOAUTH Authentication required.		<span class="c1"># 由于我设置了密码，所以，这里提示需要认证，如果你没有设置密码，这里应该返回PONG</span>
</span></span></code></pre></div><p>来说下认证的两种方式。下面是访问的同时携带密码，连接认证一起做了。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># -a 后面跟你的密码</span>
</span></span><span class="line"><span class="cl"><span class="c1"># -p 后面是6379端口，其实这个-p参数可以不带，不带默认就是访问的6379端口的Redis</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@cs opt<span class="o">]</span><span class="c1"># redis-cli -a 1234 -p 6379</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ping
</span></span><span class="line"><span class="cl">PONG
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; 
</span></span></code></pre></div><p>另一种方式就是，先连接上，然后再认证：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>root@cs opt<span class="o">]</span><span class="c1"># redis-cli						# 连接肯定是没问题，但由于设置了密码，你未通过认证之前，你啥也做不了</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ping
</span></span><span class="line"><span class="cl"><span class="o">(</span>error<span class="o">)</span> NOAUTH Authentication required.
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; auth 1234					<span class="c1"># 认证，auth命令后面跟你的密码</span>
</span></span><span class="line"><span class="cl">OK
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ping						<span class="c1"># 认证通过，你想干啥干啥</span>
</span></span><span class="line"><span class="cl">PONG
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; quit						<span class="c1"># 常见的退出客户端命令有： quit/exit/ctrl+c   注意，退出客户端只是表示关闭客户端和服务端的连接，而不是停止服务端，这点要区分开</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@cs opt<span class="o">]</span><span class="c1"># </span>
</span></span></code></pre></div><h1 id="4redis常用的全局命令">4：redis常用的全局命令：</h1>
<p>对所有的数据类型都生效的命令。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 高危命令，生产禁用！返回所有的redis中所有的key，尽量避免在生产中使用</span>
</span></span><span class="line"><span class="cl">KEYS *
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 查询以k2开头的所有KEYS</span>
</span></span><span class="line"><span class="cl">KEYS k2*
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 返回指定key的值</span>
</span></span><span class="line"><span class="cl">KEYS k1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 返回当前数据库中key的总数，这个先相当于是个计数器，生产中可以用</span>
</span></span><span class="line"><span class="cl">DBSIZE
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 返回指定key的value值的类型</span>
</span></span><span class="line"><span class="cl">TYPE k1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 删除一个key，key存在并且删除成功，返回1，否则返回0</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 删除n个key，并且都删除成功，返回删除成功的key的个数</span>
</span></span><span class="line"><span class="cl">DEL k1
</span></span><span class="line"><span class="cl">DEL k1 k2 ...kn
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 判断 key 是否存在,如果返回0，表示key不存在，如果判断多个key，例如，EXISTS k1 k2 k3，如果都存在，返回3</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 如果返回0表示都不存在，返回1,2的话，就表示只有这一两个key存在</span>
</span></span><span class="line"><span class="cl">EXISTS k1
</span></span><span class="line"><span class="cl">EXISTS k1 k2 ... kn
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 重命名</span>
</span></span><span class="line"><span class="cl">RENAME k1 k11
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 查看所有的配置项</span>
</span></span><span class="line"><span class="cl">CONFIG GET *                  <span class="c1"># 以键值对的形式返回所有的配置项</span>
</span></span><span class="line"><span class="cl">CONFIG GET appendonly         <span class="c1"># 查看指定配置项</span>
</span></span><span class="line"><span class="cl">CONFIG SET requirepass <span class="m">1234</span>   <span class="c1"># 临时动态的设置某个设置，重启redis失效，想要永久的，还是要手动的写入到配置文件中</span>
</span></span><span class="line"><span class="cl">CONFIG REWRITE                <span class="c1"># 将临时动态设置的某个设置，刷写到配置文件中</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 高危命令，生产禁用！清空redis中所有的key，找都找不回来的那种清空，如果用了，请尽早买好跑路的高铁票</span>
</span></span><span class="line"><span class="cl">FLUSHALL
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 查看服务端，此时此刻的客户端连接数</span>
</span></span><span class="line"><span class="cl">INFO CLIENTS
</span></span><span class="line"><span class="cl"><span class="c1"># 查看服务端支持的最大的客户端连接数</span>
</span></span><span class="line"><span class="cl">CONFIG GET maxclients
</span></span></code></pre></div><p>设置键值对的生存时间：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 以秒/毫秒为单位设置生存时间</span>
</span></span><span class="line"><span class="cl">EXPIRE/PEXPIRE    
</span></span><span class="line"><span class="cl"><span class="c1"># 以秒/毫秒为单位返回剩余的生存时间</span>
</span></span><span class="line"><span class="cl">TTL/PTTL   
</span></span><span class="line"><span class="cl"><span class="c1"># 即在生存时间内，取消生存时间设置</span>
</span></span><span class="line"><span class="cl">PERSIST              
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 为 k2 设置生存时间为20秒，关于返回值</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 0 表示key不存在</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 1 表示key存在，且设置过期时间成功</span>
</span></span><span class="line"><span class="cl">EXPIRE k2 <span class="m">20</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 返回 k2 剩余的生存时间，关于返回值</span>
</span></span><span class="line"><span class="cl"><span class="c1"># -1 表示key存在且永不过期</span>
</span></span><span class="line"><span class="cl"><span class="c1"># -2 表示key不存在</span>
</span></span><span class="line"><span class="cl"><span class="c1"># n  表示key存在，还有n秒后过期</span>
</span></span><span class="line"><span class="cl">TTL k2
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 取消过期时间设置，或者你可以重新 set k2 v2 当然，set这种不够优雅</span>
</span></span><span class="line"><span class="cl">PERSIST k2
</span></span></code></pre></div><p>注意，不要将大量的键值对设置为同一时间失效，避免造成缓存雪崩！</p>
<p><strong>redis存储数据的上限</strong></p>
<p>由于Redis是一个基于内存的数据库，所以它的数据存储在内存中，那么Redis数据大小限制取决于内存的大小。</p>
<p>因此，当Redis中的数据超过可用内存时，它将开始使用交换空间（swap space）或溢出文件（overflow file），这将导致系统变慢或崩溃。因此，我们需要注意Redis中数据大小的限制，以便避免这些问题的发生。</p>
<p>单个键值对的大小限制：Redis最大可以存储512MB的数据，因此，单个键值对的大小不能超过512MB。超过这个大小将导致数据丢失或内存中断。</p>
<p>Redis数据库的大小限制：每个Redis数据库默认可以最多存储2^32个键值对，当达到这个限制后，将无法再向其添加更多数据。</p>
<h2 id="禁用高危命令httpswwwcnblogscomneeoarticles17609005html禁用高危命令">禁用高危命令<a href="https://www.cnblogs.com/Neeo/articles/17609005.html#%e7%a6%81%e7%94%a8%e9%ab%98%e5%8d%b1%e5%91%bd%e4%bb%a4" target="_blank" rel="noopener noreffer ">#</a></h2>
<p>刚才学了一些命令，你可以发现有些高危命令是生产中禁止使用的，那么相信人的自觉性肯定是不靠谱的，我们需要禁用掉这些命令。</p>
<p>打开你的<code>redis.conf</code>文件，想要禁用某个命令，可以这样写：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 为某个命令赋值为空字符串，就先当于禁用掉这个命令了</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 你也可以为某个命令重命名，防止自己也没得用</span>
</span></span><span class="line"><span class="cl">rename-command KEYS <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># rename-command KEYS &#34;KEYSSS&#34;</span>
</span></span><span class="line"><span class="cl">rename-command SHUTDOWN <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">rename-command CONFIG <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">rename-command FLUSHALL <span class="s2">&#34;&#34;</span>
</span></span></code></pre></div><p>你应该根据情况决定是禁用掉某个命令还是重命名某个命令。</p>
<p>比如你直接禁用掉到<code>DEL</code>命令，但此时aof文件中有<code>DEL</code>的操作日志，那么当你重启Redis或者调整aof文件时，就会报错，因为没有这个删除命令了&hellip;..</p>
<h1 id="5redis5-数据类型篇">5:Redis5-数据类型篇</h1>
<h2 id="1字符串">1：字符串：</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cmd" data-lang="cmd"><span class="line"><span class="cl"># 如果k1 存在，那么v1 就覆盖原来的value 值 ，如果key不存在 就是设置key value值
</span></span><span class="line"><span class="cl"><span class="k">set</span> <span class="nv">k1 v1   </span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">#set key 的时候 同时设置执行过期时间 （Expiration） 
</span></span><span class="line"><span class="cl">setex k1 10 v1
</span></span><span class="line"><span class="cl"># 也可以这么写
</span></span><span class="line"><span class="cl"><span class="k">set</span> <span class="nv">k1 ex v1 10</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 同时设置多个k/v
</span></span><span class="line"><span class="cl">mset k1 v1 k2 v2 k3 v3 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 查看对应key 的剩余存货时间(time to life)
</span></span><span class="line"><span class="cl">ttl k1  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 判断 k1 是否存在，如果存在返回1 不存在返回0
</span></span><span class="line"><span class="cl">exists k1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 查看对应的key的value值
</span></span><span class="line"><span class="cl">get k1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 查看多个
</span></span><span class="line"><span class="cl">mget k1 k2 k3 k4 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">#如果k1没有，则返回一个nil并赋值，有则返回这个值并覆盖
</span></span><span class="line"><span class="cl">getset k1 v1
</span></span><span class="line"><span class="cl"><span class="p">(</span>nil<span class="p">)</span>
</span></span><span class="line"><span class="cl">get k1 
</span></span><span class="line"><span class="cl"><span class="s2">&#34;v1&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 如果key不存在，就设置一个key:value，如果key存在则什么都不做
</span></span><span class="line"><span class="cl"># 返回 0 表示key存在，啥也不做
</span></span><span class="line"><span class="cl"># 返回 1 表示key不存在，设置键值对成功
</span></span><span class="line"><span class="cl">127.0.0.1:6379<span class="p">&gt;</span> SETNX k1 v1
</span></span><span class="line"><span class="cl"><span class="p">(</span>integer<span class="p">)</span> 0
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 删除单个key，删除多个key,并返回成功删除的个数
</span></span><span class="line"><span class="cl">127.0.0.1:6379<span class="p">&gt;</span> DEL k1
</span></span><span class="line"><span class="cl"><span class="p">(</span>integer<span class="p">)</span> 1
</span></span><span class="line"><span class="cl">127.0.0.1:6379<span class="p">&gt;</span> DEL k1 k2 k3
</span></span><span class="line"><span class="cl"><span class="p">(</span>integer<span class="p">)</span> 2  # 表示成功删除两个。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 追加值，若key不存在，相当于set键值对，若key存在，将append的value拼接到原来key的value的后面
</span></span><span class="line"><span class="cl">127.0.0.1:6379<span class="p">&gt;</span> APPEND k1 v1
</span></span><span class="line"><span class="cl"><span class="p">(</span>integer<span class="p">)</span> 2
</span></span><span class="line"><span class="cl">127.0.0.1:6379<span class="p">&gt;</span> GET k1
</span></span><span class="line"><span class="cl"><span class="s2">&#34;v1&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379<span class="p">&gt;</span> APPEND k1 111
</span></span><span class="line"><span class="cl"><span class="p">(</span>integer<span class="p">)</span> 5
</span></span><span class="line"><span class="cl">127.0.0.1:6379<span class="p">&gt;</span> GET k1
</span></span><span class="line"><span class="cl"><span class="s2">&#34;v1111&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 为指定字节位置的元素替换为指定值从0开始的哦
</span></span><span class="line"><span class="cl">127.0.0.1:6379<span class="p">&gt;</span> SET k7 0123456789
</span></span><span class="line"><span class="cl">127.0.0.1:6379<span class="p">&gt;</span> SETRANGE k7 5 A   # 将第5个字节位置的值替换为 A
</span></span><span class="line"><span class="cl"><span class="p">(</span>integer<span class="p">)</span> 10
</span></span><span class="line"><span class="cl">127.0.0.1:6379<span class="p">&gt;</span> GET k7  # 替换后的结果
</span></span><span class="line"><span class="cl"><span class="s2">&#34;01234A6789&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379<span class="p">&gt;</span> SETRANGE k7 12 BC  # 如果指定的字节数超出字符串长度，就补零
</span></span><span class="line"><span class="cl"><span class="p">(</span>integer<span class="p">)</span> 14
</span></span><span class="line"><span class="cl">127.0.0.1:6379<span class="p">&gt;</span> GET k7 
</span></span><span class="line"><span class="cl"><span class="s2">&#34;01234A6789\x00\x00BC&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379<span class="p">&gt;</span> SETRANGE k7 6 7 BC   # 不允许这种将第6~7字节位置的元素替换为指定值
</span></span><span class="line"><span class="cl"><span class="p">(</span>error<span class="p">)</span> ERR wrong number of arguments for &#39;setrange&#39; command
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 判断key是否存在，存在返回1，否则返回0
</span></span><span class="line"><span class="cl">127.0.0.1:6379<span class="p">&gt;</span> EXISTS k1
</span></span><span class="line"><span class="cl"><span class="p">(</span>integer<span class="p">)</span> 1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 如果key存在，返回值的长度，否则返回0
</span></span><span class="line"><span class="cl">127.0.0.1:6379<span class="p">&gt;</span> STRLEN k1
</span></span><span class="line"><span class="cl"><span class="p">(</span>integer<span class="p">)</span> 2
</span></span><span class="line"><span class="cl">127.0.0.1:6379<span class="p">&gt;</span> STRLEN k222   # k222不存在
</span></span><span class="line"><span class="cl"><span class="p">(</span>integer<span class="p">)</span> 0
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 返回字符串指定字节范围的值
</span></span><span class="line"><span class="cl">127.0.0.1:6379<span class="p">&gt;</span> SET k7 0123456789
</span></span><span class="line"><span class="cl">OK
</span></span><span class="line"><span class="cl">127.0.0.1:6379<span class="p">&gt;</span> GETRANGE k7 1 5   # 第1~5个字节范围内的值，注意，索引从0开始
</span></span><span class="line"><span class="cl"><span class="s2">&#34;12345&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379<span class="p">&gt;</span> GETRANGE k7 5 15  # 第5~15个字节范围内的值，如果字符串长度不够，以起始位置开始，有多少返回多少
</span></span><span class="line"><span class="cl"><span class="s2">&#34;56789&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379<span class="p">&gt;</span> GETRANGE k7 15 20  # 起始和结束范围都不在字符串范围内，返回空
</span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;</span>
</span></span></code></pre></div><p>上例中有对范围设置值或者取值的操作，但谨记，不能对中文这么做，因为一个中文由多个字节组成。</p>
<p>计数器功能：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">127.0.0.1:6379&gt; INCR num		 <span class="c1"># 每次调用INCR命令，num值自加一，num提前可以不存在</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; INCR num
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">2</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; INCRBY num 10	  <span class="c1"># 一次性加n</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">12</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; INCRBY num <span class="m">100</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">112</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; DECR num          <span class="c1"># DECR 使num自减一</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">111</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; decrby num 10	  <span class="c1"># 一次性减n</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">101</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; DECR num1		  <span class="c1"># 如果num1这个key不存在，则先设置为0，再减一</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> -1
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; GET num           <span class="c1"># 可以通过GET获取该计数器的值</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;101&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; GET num1
</span></span><span class="line"><span class="cl"><span class="s2">&#34;-1&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; TYPE num		  <span class="c1"># 注意，值仍然是字符串</span>
</span></span><span class="line"><span class="cl">string
</span></span></code></pre></div><h2 id="2列表">2:列表#</h2>
<p>应用场景：</p>
<ul>
<li>消息队列系统</li>
<li>最新的微博消息，比如我们将最新发布的热点消息都存储到Redis中，只有翻看&quot;历史久远&quot;的个人信息，这类冷数据时，才去MySQL中查询</li>
</ul>
<p>列表的特点：</p>
<ul>
<li>后插入的在最前面，相当于每次都默认在索引0前面做插入操作。这个特性相当于微信朋友圈，最新发布的的动态在最上面。</li>
<li>列表内每一个元素都有自己的下标索引，从左到右，从0开始；从右到左，从<code>-1</code>开始，这跟Python中的列表一样。</li>
<li>列表中的元素可重复。</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 增</span>
</span></span><span class="line"><span class="cl">LPUSH l1 a b                         <span class="c1"># 如果 l1 不存在就创建，然后将 a b 插入到 l1 中，如果 l1 存在，直接将 a b 插入到 l1 中  注意 从左边插入，所以a先进去，然后b进去，所以b在a左边</span>
</span></span><span class="line"><span class="cl">LPUSHX l1 c                          <span class="c1"># 如果 key 存在则插入，不存在则什么也不做</span>
</span></span><span class="line"><span class="cl">LINSERT l1 before a a1               <span class="c1"># 在元素 a 前面插入 a1</span>
</span></span><span class="line"><span class="cl">LINSERT l1 after a a2                <span class="c1"># 在元素 a 后插入 a2</span>
</span></span><span class="line"><span class="cl">RPUSH l1 <span class="m">1</span>                           <span class="c1"># 在列表尾部追加 元素 1</span>
</span></span><span class="line"><span class="cl">RPUSH l1 <span class="m">2</span> <span class="m">3</span>                         <span class="c1"># 在列表尾部先追加 2 再追加 3 ,注意这里的插入从左往右就是123了</span>
</span></span><span class="line"><span class="cl">RPUSHX l1 <span class="m">4</span>                          <span class="c1"># 如果列表 l1 存在就将元素4追加到列表尾部，如果列表不存在则什么也不做</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 查，根据索引下标取值</span>
</span></span><span class="line"><span class="cl">LRANGE l1 <span class="m">0</span> -1                       <span class="c1"># 从索引0开始取到-1，也就是从头取到尾，获取列表中的所有元素</span>
</span></span><span class="line"><span class="cl">LRANGE l1 <span class="m">0</span> <span class="m">2</span>                        <span class="c1"># 取索引 0 1 2 三个索引对应的元素</span>
</span></span><span class="line"><span class="cl">LRANGE l1 <span class="m">0</span> <span class="m">0</span>                        <span class="c1"># 取索引 0 对应的元素</span>
</span></span><span class="line"><span class="cl">LRANGE l1 <span class="m">10</span> <span class="m">15</span>                      <span class="c1"># 如果索引不在合法范围内，则取空</span>
</span></span><span class="line"><span class="cl">LINDEX l1 <span class="m">1</span>                          <span class="c1"># 根据索引下标返回元素</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 删除</span>
</span></span><span class="line"><span class="cl">DEL	l1								 <span class="c1"># 删除整个列表</span>
</span></span><span class="line"><span class="cl">LPOP l1                              <span class="c1"># 抛出列表头部元素</span>
</span></span><span class="line"><span class="cl">RPOP l1                              <span class="c1"># 抛出列表尾部元素</span>
</span></span><span class="line"><span class="cl">RPOPLPUSH l1 l2                      <span class="c1"># 将列表 l1 尾部的元素抛出并且添加到列表 l2 中</span>
</span></span><span class="line"><span class="cl">LREM l1 <span class="m">2</span> a1                         <span class="c1"># 从左到右，删除指定个数的元素 a1 ，本示例中，若 a1 有 1 个，就删一个，若 a1  有 3 个或者更多，也就删除 2 个</span>
</span></span><span class="line"><span class="cl">LTRIM l1 <span class="m">2</span> <span class="m">4</span>                         <span class="c1"># 保留索引2-4的元素，其余删除</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 改</span>
</span></span><span class="line"><span class="cl">LSET l1 <span class="m">0</span> a                          <span class="c1"># 将列表索引为0的元素修改为指定值，如果索引位置不存在则报错</span>
</span></span></code></pre></div><h2 id="3redis-hashhttpswwwcnblogscomneeoarticles17609005htmlhash">3:Redis-hash<a href="https://www.cnblogs.com/Neeo/articles/17609005.html#hash" target="_blank" rel="noopener noreffer ">#</a></h2>
<p>应用场景：</p>
<ul>
<li>作为MySQL的缓存。</li>
</ul>
<p>对应关系：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mysql数据格式：
</span></span><span class="line"><span class="cl">user表
</span></span><span class="line"><span class="cl">id	 name	job	  age
</span></span><span class="line"><span class="cl"><span class="m">1</span>    zhang  it    <span class="m">18</span>
</span></span><span class="line"><span class="cl"><span class="m">2</span> 	 wang   it    <span class="m">24</span>
</span></span><span class="line"><span class="cl"><span class="m">3</span>    zhao   it    <span class="m">20</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">对应hash类型存储格式：
</span></span><span class="line"><span class="cl">key 	field1 	value 	field2 	value 	field3 	value
</span></span><span class="line"><span class="cl">user:1 	name 	zhang 	job 	it 		age 	<span class="m">18</span>
</span></span><span class="line"><span class="cl">user:2 	name 	wang 	job 	it 		age 	<span class="m">18</span>
</span></span><span class="line"><span class="cl">user:3 	name 	zhao 	job 	it 		age 	<span class="m">18</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">user对应MySQL的表，n和MySQL中user表的id一一对应
</span></span><span class="line"><span class="cl">user:n
</span></span></code></pre></div><p>操作：</p>
<ul>
<li>都是H开头的命令</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 增</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; HMSET user:1 name zhangkai age <span class="m">18</span> gender m
</span></span><span class="line"><span class="cl">OK
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; HMSET user:2 name wangkai age <span class="m">18</span> gender m
</span></span><span class="line"><span class="cl">OK
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 查</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 获取指定字段的值，相当于 select name from user where id=1;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; HGET user:1 name
</span></span><span class="line"><span class="cl"><span class="s2">&#34;zhangkai&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 获取多个指定字段的值，相当于 select name,age from user where id=1;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; HMGET user:1 name age
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;zhangkai&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;18&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 获取所有键值对，相当于 select * from user;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; HGETALL user:1
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;name&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;zhangkai&#34;</span>
</span></span><span class="line"><span class="cl">3<span class="o">)</span> <span class="s2">&#34;age&#34;</span>
</span></span><span class="line"><span class="cl">4<span class="o">)</span> <span class="s2">&#34;18&#34;</span>
</span></span><span class="line"><span class="cl">5<span class="o">)</span> <span class="s2">&#34;gender&#34;</span>
</span></span><span class="line"><span class="cl">6<span class="o">)</span> <span class="s2">&#34;m&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 判断指定字段是否存在，存在返回1，否则返回0</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; HEXISTS user:1 name
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 返回key中所有字段的数量</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; HLEN user:1
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">3</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 改</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; HINCRBY user:1 age 8			<span class="c1"># 为整型字段的值加固定数字</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; HSET user:1 name zhangkai2		<span class="c1"># 为指定字段重新赋值</span>
</span></span></code></pre></div><h2 id="4集合httpswwwcnblogscomneeoarticles17609005html集合">4集合<a href="https://www.cnblogs.com/Neeo/articles/17609005.html#%e9%9b%86%e5%90%88" target="_blank" rel="noopener noreffer ">#</a></h2>
<p>集合的应用场景：</p>
<ul>
<li>适用于各种需要求交集、并集、差集的场景，比如共同好友，共同关注的场景。</li>
<li>另外这里的集合也有数学上的集合特性，去重，交、并、差集的运算。</li>
</ul>
<p>基础操作：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 增</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; SADD s1 a b c		<span class="c1"># 声明key并添加 a b c 三个元素</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">3</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; SMEMBERS s1			<span class="c1"># 返回 s1 中所有元素</span>
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;c&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;b&#34;</span>
</span></span><span class="line"><span class="cl">3<span class="o">)</span> <span class="s2">&#34;a&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; SCARD s1			<span class="c1"># 返回 s1 中元素的个数</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">3</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; SRANDMEMBER s1		<span class="c1"># 随机返回集合中的1个元素</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;a&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; SRANDMEMBER s1
</span></span><span class="line"><span class="cl"><span class="s2">&#34;a&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; SRANDMEMBER s1
</span></span><span class="line"><span class="cl"><span class="s2">&#34;c&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; SRANDMEMBER s1
</span></span><span class="line"><span class="cl"><span class="s2">&#34;b&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; SRANDMEMBER s1 <span class="m">2</span>    <span class="c1"># 随机返回指定个数的元素</span>
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;b&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;c&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; SISMEMBER s1 a		<span class="c1"># 判断元素 a 是否存在</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 删除</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; SPOP s1				<span class="c1"># 随机删除一个元素，并将这个元素返回</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;c&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; SPOP s1	2			<span class="c1"># 随机删除指定个数的元素，并将多个元素返回</span>
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;d&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;a&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; DEL s1				<span class="c1"># 删除集合</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 移动</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; SADD s1 a b c		<span class="c1"># 将元素 a 从s1移动到s2中，如果s2不存在，就先创建再移动</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">3</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; SMOVE s1 s2 a       <span class="c1"># 注意，一次只能移动一个，不支持多个，比如：SMOVE s1 s2 a b c</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; SMEMBERS s1
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;c&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;b&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; SMEMBERS s2
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;a&#34;</span>
</span></span></code></pre></div><p>再来看集合的运算。我们来个示例，有个需求，现有个培训学校开设了Python和Linux两门课程，来学习的同学都有如下情况：</p>
<ul>
<li>有的同学学习Linux</li>
<li>有的学习Python</li>
<li>还有的既学了Linux又学了Python</li>
</ul>
<p>那现在问题来了，我们要对这些同学的情况做统计，比如找出两门课都报了的同学？</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/posts/redis/image-20231021200313972.png"
        data-srcset="/images/posts/redis/image-20231021200313972.png, /images/posts/redis/image-20231021200313972.png 1.5x, /images/posts/redis/image-20231021200313972.png 2x"
        data-sizes="auto"
        alt="/images/posts/redis/image-20231021200313972.png"
        title="image-20231021200313972" /></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 先把数据准备好</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; SADD python xiaoA xiaoB Huluwa xiaoC xiaoMaque 
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">5</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; SADD linux xiaoC xiaoMaque xiaoD xiaoE xiaoDongbei
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">5</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 求交集，找出即学习了Python又学习了Linux的同学</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; SINTER python linux      <span class="c1"># 这俩集合谁在前谁在后没区别</span>
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;xiaoC&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;xiaoMaque&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 求交集，找出即学习了Python又学习了Linux的同学，并将结果保存到集合tmp中，tmp不存在则先创建</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; SINTERSTORE tmp python linux  
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">2</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; SMEMBERS tmp
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;xiaoMaque&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;xiaoC&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 求并集，找出学习两门课程的所有人</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; SUNION python linux
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;xiaoE&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;xiaoA&#34;</span>
</span></span><span class="line"><span class="cl">3<span class="o">)</span> <span class="s2">&#34;xiaoB&#34;</span>
</span></span><span class="line"><span class="cl">4<span class="o">)</span> <span class="s2">&#34;xiaoD&#34;</span>
</span></span><span class="line"><span class="cl">5<span class="o">)</span> <span class="s2">&#34;xiaoDongbei&#34;</span>
</span></span><span class="line"><span class="cl">6<span class="o">)</span> <span class="s2">&#34;xiaoMaque&#34;</span>
</span></span><span class="line"><span class="cl">7<span class="o">)</span> <span class="s2">&#34;xiaoC&#34;</span>
</span></span><span class="line"><span class="cl">8<span class="o">)</span> <span class="s2">&#34;Huluwa&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 求并集，找出学习两门课程的所有人，并将结果保存到集合tmp中，tmp不存在则先创建</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; SUNIONSTORE tmp python linux
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">8</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; SMEMBERS tmp
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;xiaoE&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;xiaoA&#34;</span>
</span></span><span class="line"><span class="cl">3<span class="o">)</span> <span class="s2">&#34;xiaoB&#34;</span>
</span></span><span class="line"><span class="cl">4<span class="o">)</span> <span class="s2">&#34;xiaoD&#34;</span>
</span></span><span class="line"><span class="cl">5<span class="o">)</span> <span class="s2">&#34;xiaoDongbei&#34;</span>
</span></span><span class="line"><span class="cl">6<span class="o">)</span> <span class="s2">&#34;xiaoMaque&#34;</span>
</span></span><span class="line"><span class="cl">7<span class="o">)</span> <span class="s2">&#34;xiaoC&#34;</span>
</span></span><span class="line"><span class="cl">8<span class="o">)</span> <span class="s2">&#34;Huluwa&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 求差集，找出只学习了Python（或者Linux）课程的人</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; SDIFF python linux			<span class="c1"># 只学习Python课程的人</span>
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;xiaoA&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;xiaoB&#34;</span>
</span></span><span class="line"><span class="cl">3<span class="o">)</span> <span class="s2">&#34;Huluwa&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; SDIFFSTORE tmp python linux <span class="c1"># 只学习Python课程的人,并将结果保存到集合tmp中，tmp不存在则先创建</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">3</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; SMEMBERS tmp
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;xiaoA&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;xiaoB&#34;</span>
</span></span><span class="line"><span class="cl">3<span class="o">)</span> <span class="s2">&#34;Huluwa&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; SDIFF linux python			<span class="c1"># 只学习Linux课程的人</span>
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;xiaoDongbei&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;xiaoE&#34;</span>
</span></span><span class="line"><span class="cl">3<span class="o">)</span> <span class="s2">&#34;xiaoD&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># # 只学习Linux课程的人,并将结果保存到集合tmp中，tmp不存在则先创建</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; SDIFFSTORE tmp linux python
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">3</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; SMEMBERS tmp
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;xiaoDongbei&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;xiaoE&#34;</span>
</span></span><span class="line"><span class="cl">3<span class="o">)</span> <span class="s2">&#34;xiaoD&#34;</span>
</span></span></code></pre></div><h2 id="5-有序集合zsethttpswwwcnblogscomneeoarticles17609005html有序集合zset">5 有序集合zset<a href="https://www.cnblogs.com/Neeo/articles/17609005.html#%e6%9c%89%e5%ba%8f%e9%9b%86%e5%90%88zset" target="_blank" rel="noopener noreffer ">#</a></h2>
<p>有序集合在集合的基础上增加了排序功能，比如以点击数为条件进行排序。
有序集合的典型应用场景：</p>
<ul>
<li>各种排行榜，音乐排行榜、热点新闻榜&hellip;..</li>
</ul>
<p>在有序集合中，我们一般称其元素为成员，其成员对应的值为得分。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 增加</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZADD top <span class="m">0</span> xuwei <span class="m">0</span> zhoujielun
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 查, withscores是可选参数，表示同时返回其成员和其得分</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZSCORE top xuwei				<span class="c1"># 返回top中，指定成员的分数，如果指定成员不存在则返回nil</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;0&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZSCORE top zhangkai  		
</span></span><span class="line"><span class="cl"><span class="o">(</span>nil<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 返回top中所有成员，默认以分数大小升序排序，分值相同按ASCII编码排序</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZRANGE top <span class="m">0</span> -1
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;xuwei&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;zhoujielun&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZRANGE top <span class="m">0</span> -1 WITHSCORES
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;xuwei&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;0&#34;</span>
</span></span><span class="line"><span class="cl">3<span class="o">)</span> <span class="s2">&#34;zhoujielun&#34;</span>
</span></span><span class="line"><span class="cl">4<span class="o">)</span> <span class="s2">&#34;0&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 返回成员在有序集合中的索引下标，如果成员不存在返回nil    </span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZRANK top xuwei
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZRANK top zhangkai
</span></span><span class="line"><span class="cl"><span class="o">(</span>nil<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 返回top中成员的数量</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZCARD top
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 返回top中所有成员，-inf表示第一个成员，+inf表示最后一个成员，结果默认以其分数的大小排序</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZRANGEBYSCORE top -inf +inf
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;xuwei&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;zhoujielun&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZRANGEBYSCORE top -inf +inf WITHSCORES
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;xuwei&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;0&#34;</span>
</span></span><span class="line"><span class="cl">3<span class="o">)</span> <span class="s2">&#34;zhoujielun&#34;</span>
</span></span><span class="line"><span class="cl">4<span class="o">)</span> <span class="s2">&#34;0&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 返回top中所有成员，并且以索引从大到小排序</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZREVRANGE top <span class="m">0</span> -1
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;zhoujielun&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;xuwei&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZREVRANGE top <span class="m">0</span> -1 WITHSCORES
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;zhoujielun&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;0&#34;</span>
</span></span><span class="line"><span class="cl">3<span class="o">)</span> <span class="s2">&#34;xuwei&#34;</span>
</span></span><span class="line"><span class="cl">4<span class="o">)</span> <span class="s2">&#34;0&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 返回top中 0 &lt;= index &lt;= 2 索引范围内的成员，不在范围内返回空</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZREVRANGE top <span class="m">0</span> <span class="m">2</span>
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;zhoujielun&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;xuwei&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZREVRANGE top <span class="m">0</span> <span class="m">2</span> WITHSCORES
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;zhoujielun&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;0&#34;</span>
</span></span><span class="line"><span class="cl">3<span class="o">)</span> <span class="s2">&#34;xuwei&#34;</span>
</span></span><span class="line"><span class="cl">4<span class="o">)</span> <span class="s2">&#34;0&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZREVRANGE top <span class="m">3</span> <span class="m">5</span> WITHSCORES
</span></span><span class="line"><span class="cl"><span class="o">(</span>empty list or <span class="nb">set</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 返回top中分数在 20 &lt;= 分数 &lt;= 200 这个范围内的成员的数量</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZADD top <span class="m">20</span> xuwei <span class="m">80</span> zhoujielun <span class="m">100</span> daolang <span class="m">120</span> zhaolei   <span class="c1"># 先搞个数据</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZCOUNT top <span class="m">20</span> <span class="m">200</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">4</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 返回top中分数在 20 &lt;= 分数 &lt;= 200 这个范围内的成员</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZRANGEBYSCORE top <span class="m">20</span> <span class="m">200</span>
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;xuwei&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;zhoujielun&#34;</span>
</span></span><span class="line"><span class="cl">3<span class="o">)</span> <span class="s2">&#34;daolang&#34;</span>
</span></span><span class="line"><span class="cl">4<span class="o">)</span> <span class="s2">&#34;zhaolei&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZRANGEBYSCORE top <span class="m">20</span> <span class="m">200</span> WITHSCORES
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;xuwei&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;20&#34;</span>
</span></span><span class="line"><span class="cl">3<span class="o">)</span> <span class="s2">&#34;zhoujielun&#34;</span>
</span></span><span class="line"><span class="cl">4<span class="o">)</span> <span class="s2">&#34;80&#34;</span>
</span></span><span class="line"><span class="cl">5<span class="o">)</span> <span class="s2">&#34;daolang&#34;</span>
</span></span><span class="line"><span class="cl">6<span class="o">)</span> <span class="s2">&#34;100&#34;</span>
</span></span><span class="line"><span class="cl">7<span class="o">)</span> <span class="s2">&#34;zhaolei&#34;</span>
</span></span><span class="line"><span class="cl">8<span class="o">)</span> <span class="s2">&#34;120&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 返回top中分数范围在 100 &lt;= 的 &lt;= 20 范围内的成员，并以的的大小降序排序</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZREVRANGEBYSCORE top <span class="m">100</span> <span class="m">20</span>
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;daolang&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;zhoujielun&#34;</span>
</span></span><span class="line"><span class="cl">3<span class="o">)</span> <span class="s2">&#34;xuwei&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZREVRANGEBYSCORE top <span class="m">100</span> <span class="m">20</span> WITHSCORES
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;daolang&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;100&#34;</span>
</span></span><span class="line"><span class="cl">3<span class="o">)</span> <span class="s2">&#34;zhoujielun&#34;</span>
</span></span><span class="line"><span class="cl">4<span class="o">)</span> <span class="s2">&#34;80&#34;</span>
</span></span><span class="line"><span class="cl">5<span class="o">)</span> <span class="s2">&#34;xuwei&#34;</span>
</span></span><span class="line"><span class="cl">6<span class="o">)</span> <span class="s2">&#34;20&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 改</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 为指定成员重新赋值</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZADD top <span class="m">30</span> xuwei
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 为指定成员增加指定分数，并返回增加后的分数</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZINCRBY top <span class="m">10</span> xuwei
</span></span><span class="line"><span class="cl"><span class="s2">&#34;40&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 删除</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 删除分数在指定范围内的成员，并返回删除成员的数量</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZREMRANGEBYSCORE top <span class="m">80</span> <span class="m">100</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 删除top中指定索引范围内 0 &lt;= index &lt;= 1 的成员</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZREMRANGEBYRANK top <span class="m">0</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 删除top中一个或者多个成员，返回实际删除的个数，没有找到key返回0</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZREMRANGEBYRANK top <span class="m">0</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; DEL top
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">1</span>
</span></span></code></pre></div><p>来个音乐排行榜的示例：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 创建初始的音乐排行榜，初始每首歌播放量都是0</span>
</span></span><span class="line"><span class="cl">ZADD top <span class="m">0</span> aiqing <span class="m">0</span> guxiang <span class="m">0</span> lanlianhua <span class="m">0</span> shiguang
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 模拟每首歌的播放量</span>
</span></span><span class="line"><span class="cl">ZINCRBY top <span class="m">123</span> aiqing
</span></span><span class="line"><span class="cl">ZINCRBY top <span class="m">223</span> guxiang
</span></span><span class="line"><span class="cl">ZINCRBY top <span class="m">203</span> lanlianhua
</span></span><span class="line"><span class="cl">ZINCRBY top <span class="m">103</span> shiguang
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 返回播放量前三名的歌名</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZREVRANGE top <span class="m">0</span> <span class="m">2</span> WITHSCORES
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;guxiang&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;223&#34;</span>
</span></span><span class="line"><span class="cl">3<span class="o">)</span> <span class="s2">&#34;lanlianhua&#34;</span>
</span></span><span class="line"><span class="cl">4<span class="o">)</span> <span class="s2">&#34;203&#34;</span>
</span></span><span class="line"><span class="cl">5<span class="o">)</span> <span class="s2">&#34;aiqing&#34;</span>
</span></span><span class="line"><span class="cl">6<span class="o">)</span> <span class="s2">&#34;123&#34;</span>
</span></span></code></pre></div><h1 id="6redis-发布订阅">6：redis-发布订阅</h1>
<blockquote>
<p><a href="https://www.cnblogs.com/Neeo/articles/13914727.html" target="_blank" rel="noopener noreffer ">消息队列</a></p>
</blockquote>
<p>Redis中的发布订阅模式，类似于RabbitMQ中的主题订阅模式。
在发布订阅模式中，有三个角色：</p>
<ul>
<li>生产者，它同样是一个redis客户端，负责生产消息。可以有一个或者多个生产者往一个或者多个频道中发布消息。</li>
<li>channel，频道，类似于主题，接收来自于生产者产生的消息，为不同的消息打个标签，可以有多个频道。它维护在redis的server中。</li>
<li>消费者，也是一个Redis客户端，可以订阅感兴趣的消息，也就是可以(一个或者多个)订阅不同频道的消息。</li>
</ul>
<p><a href="https://img2020.cnblogs.com/blog/1168165/202012/1168165-20201230181732841-1538770246.png" target="_blank" rel="noopener noreffer "><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://img2020.cnblogs.com/blog/1168165/202012/1168165-20201230181732841-1538770246.png"
        data-srcset="https://img2020.cnblogs.com/blog/1168165/202012/1168165-20201230181732841-1538770246.png, https://img2020.cnblogs.com/blog/1168165/202012/1168165-20201230181732841-1538770246.png 1.5x, https://img2020.cnblogs.com/blog/1168165/202012/1168165-20201230181732841-1538770246.png 2x"
        data-sizes="auto"
        alt="https://img2020.cnblogs.com/blog/1168165/202012/1168165-20201230181732841-1538770246.png"
        title="img" /></a></p>
<p>如上图，有三个生产者负责生产消息，并且发布到指定的频道中，消费者可以选择订阅一个或者多个频道中的消息。</p>
<p>操作：</p>
<pre tabindex="0"><code class="language-mipsasm" data-lang="mipsasm"># 首先要现有多个消费者订阅不同的频道，订阅一个、多个、模糊匹配；你可以起三个终端来分别订阅
SUBSCRIBE fm103
SUBSCRIBE fm103 fm104
PSUBSCRIBE fm*

# 然后有不同的生产者往指定的频道生产消息，可以用三个终端来发布消息，也可以用一个也行，分别向不同的频道发布消息
PUBLISH fm103 &#34;fm103.9 it&#39;s my radio, messages1&#34;
PUBLISH fm103 &#34;fm103.9 it&#39;s my radio, messages2&#34;
PUBLISH fm103 &#34;fm103.9 it&#39;s my radio, messages3&#34;
PUBLISH fm104 &#34;fm104.9 it&#39;s my radio, messages1&#34;
PUBLISH fm104 &#34;fm104.9 it&#39;s my radio, messages2&#34;
PUBLISH fm104 &#34;fm104.9 it&#39;s my radio, messages3&#34;
PUBLISH fm105 &#34;fm105.9 it&#39;s my radio, messages1&#34;
PUBLISH fm105 &#34;fm105.9 it&#39;s my radio, messages2&#34;
PUBLISH fm105 &#34;fm105.9 it&#39;s my radio, messages3&#34;
</code></pre><p>上述几个消费者就能根据自己的规则接收到不同的频道的消息，其效果如下图</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/posts/redis/image-20231022091038474.png"
        data-srcset="/images/posts/redis/image-20231022091038474.png, /images/posts/redis/image-20231022091038474.png 1.5x, /images/posts/redis/image-20231022091038474.png 2x"
        data-sizes="auto"
        alt="/images/posts/redis/image-20231022091038474.png"
        title="image-20231022091038474" /></p>
<p>这里需要注意的是，消费者不会接收频道的历史消息，只会接受订阅后产生的消息。</p>
<p>其他操作：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 取消订阅频道</span>
</span></span><span class="line"><span class="cl">UNSUBSCRIBE                  <span class="c1"># 不跟频道号则取消订阅所有频道</span>
</span></span><span class="line"><span class="cl">UNSUBSCRIBE fm103            <span class="c1"># 取消订阅fm103频道</span>
</span></span><span class="line"><span class="cl">UNSUBSCRIBE fm103 fm104      <span class="c1"># 取消订阅多个频道</span>
</span></span><span class="line"><span class="cl">UNSUBSCRIBE fm*              <span class="c1"># 取消订阅以fm开头的频道</span>
</span></span></code></pre></div><p>Redis发布订阅优点：</p>
<ul>
<li>Redis的发布订阅支持多个生产者/消费者，同时生产消费消息，优点就是非常简洁，因为它的实现原理就是单纯地为生产者、消费者建立「数据转发通道」，把符合规则的数据，从一端转发到另一端。</li>
</ul>
<p>缺点:</p>
<ul>
<li>发布订阅模式是&quot;发后既忘&quot;的工作模式，如果订阅者离线，那么重连之后不能消费之前的历史消息。</li>
<li>无法持久化保存消息，如果 Redis 服务器宕机或重启，那么所有的消息将会丢失。</li>
<li>积压的消息不能太多，否则也会丢数据【可以通过client-output-buffer-limit这个参数配置】。</li>
</ul>
<p>小结：对于特别简单的发布订阅场景，可以考虑Redis的发布订阅功能，但是复杂的场景，还是选择专业的消息队</p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2024-04-14</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="http://localhost:1313/posts/redis/" data-title="redis安装"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="http://localhost:1313/posts/redis/"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Hacker News" data-sharer="hackernews" data-url="http://localhost:1313/posts/redis/" data-title="redis安装"><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Line" data-sharer="line" data-url="http://localhost:1313/posts/redis/" data-title="redis安装"><i data-svg-src="/lib/simple-icons/icons/line.min.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on 微博" data-sharer="weibo" data-url="http://localhost:1313/posts/redis/" data-title="redis安装"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on 百度" data-sharer="baidu" data-url="http://localhost:1313/posts/redis/" data-title="redis安装"><i data-svg-src="/lib/simple-icons/icons/baidu.min.svg" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/demo02/" class="prev" rel="prev" title="图片验证码识别"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>图片验证码识别</a>
            <a href="/posts/jwt/" class="next" rel="next" title="Jwt算法">Jwt算法<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">tel:17879765153</div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2023 - 2024</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/about/" target="_blank">ytw</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","maxResultLength":10,"noResultsFound":"No results found","snippetLength":50,"type":"lunr"}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
